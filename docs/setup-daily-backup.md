# Windows 每日自动 Git 备份设置指南

本指南将帮助您在 Windows 系统中设置每日自动执行 Git 备份的任务计划。

## 📋 前置条件

- 项目已初始化为 Git 仓库（包含 `.git` 目录）
- 已配置 Git 远程仓库（GitHub）
- 已安装 PowerShell（Windows 10/11 自带）

## 🚀 设置步骤

### 步骤 1：打开任务计划程序

1. 按 `Win + R` 打开运行对话框
2. 输入 `taskschd.msc` 并按回车
3. 或者通过开始菜单搜索"任务计划程序"

### 步骤 2：创建基本任务

1. 在右侧操作面板中，点击"创建基本任务..."
2. 输入任务名称：`Daily Git Backup`
3. 输入任务描述：`每日自动备份项目到 GitHub`
4. 点击"下一步"

### 步骤 3：设置触发器

1. 选择"每天"
2. 点击"下一步"
3. 设置开始时间（建议设置为每天凌晨 2:00 或您方便的时间）
4. 设置重复间隔：每 `1` 天
5. 点击"下一步"

### 步骤 4：设置操作

1. 选择"启动程序"
2. 点击"下一步"
3. 在"程序或脚本"中输入：
   ```
   D:\project\wuxiaworld-clone\daily-backup-runner.bat
   ```
   （请根据您的实际项目路径修改）
4. 在"起始于"中输入：
   ```
   D:\project\wuxiaworld-clone
   ```
5. 点击"下一步"

### 步骤 5：完成设置

1. 勾选"当单击完成时，打开此任务属性的对话框"
2. 点击"完成"

### 步骤 6：配置高级选项

在任务属性对话框中：

1. **常规选项卡**：
   - ✅ 勾选"使用最高权限运行"
   - ✅ 勾选"不管用户是否登录都要运行"
   - 配置为：`Windows 10/Windows Server 2016`

2. **条件选项卡**：
   - ✅ 取消勾选"只有在计算机使用交流电源时才启动此任务"（如果希望笔记本也能执行）
   - ✅ 取消勾选"只有在以下网络连接可用时才启动"（如果希望离线也能执行）

3. **设置选项卡**：
   - ✅ 勾选"允许按需运行任务"
   - ✅ 勾选"如果任务失败，重新启动任务"
   - 设置"尝试重新启动的时间间隔"：`10 分钟`
   - 设置"尝试重新启动最多"：`3 次`
   - ✅ 勾选"如果任务已在运行，则以下规则适用"：`不启动新实例`

4. 点击"确定"保存设置

## 🧪 测试运行

### 方法 1：通过任务计划程序测试

1. 在任务计划程序中找到 `Daily Git Backup` 任务
2. 右键点击任务
3. 选择"运行"
4. 查看任务状态，确认执行成功

### 方法 2：手动运行批处理文件

1. 双击 `daily-backup-runner.bat` 文件
2. 查看 PowerShell 窗口输出，确认备份成功

### 方法 3：检查 Git 提交历史

```powershell
cd D:\project\wuxiaworld-clone
git log --oneline -5
```

应该能看到带有 "Daily auto-backup:" 前缀的提交记录。

## 📝 注意事项

1. **首次运行**：如果 Git 需要身份验证，可能需要先手动运行一次并输入凭据
2. **无变更时**：如果当天没有代码变更，Git 会提示 "nothing to commit"，这是正常现象
3. **网络问题**：如果网络连接失败，任务会失败，但会在设置的重试间隔后自动重试
4. **权限问题**：确保任务计划程序有足够权限访问项目目录和执行 Git 命令

## 🔧 故障排除

### 问题 1：任务执行失败

**解决方案**：
- 检查批处理文件路径是否正确
- 确认 PowerShell 执行策略允许运行脚本（已通过 `-ExecutionPolicy Bypass` 解决）
- 查看任务计划程序中的"历史记录"选项卡，查看详细错误信息

### 问题 2：Git 推送失败

**解决方案**：
- 确认已配置 Git 远程仓库：`git remote -v`
- 确认已设置 Git 凭据：在 Windows 凭据管理器中检查
- 手动运行一次备份脚本，查看具体错误信息

### 问题 3：脚本找不到项目目录

**解决方案**：
- 确认 `daily-backup-runner.bat` 和 `scripts/daily-git-backup.ps1` 文件都在正确位置
- 检查项目路径是否正确

## 📅 修改备份时间

如果需要修改备份时间：

1. 在任务计划程序中找到 `Daily Git Backup` 任务
2. 右键点击 → "属性"
3. 切换到"触发器"选项卡
4. 双击现有触发器
5. 修改开始时间
6. 点击"确定"保存

## 🛑 停止自动备份

如果需要临时停止自动备份：

1. 在任务计划程序中找到 `Daily Git Backup` 任务
2. 右键点击 → "禁用"

重新启用时，选择"启用"即可。

---

**创建时间**：$(Get-Date -Format "yyyy-MM-dd")
**脚本位置**：`scripts/daily-git-backup.ps1`
**启动脚本**：`daily-backup-runner.bat`

