# Karma APIé”™è¯¯ä¿®å¤æ€»ç»“

## é—®é¢˜æè¿°

ç”¨æˆ·æŠ¥å‘ŠKarmaé¡µé¢æ˜¾ç¤º"é”™è¯¯ï¼šè·å–Karmaäº¤æ˜“è®°å½•å¤±è´¥"ï¼Œå¯¼è‡´é¡µé¢æ— æ³•æ­£å¸¸æ˜¾ç¤ºKarmaæ•°æ®ã€‚

## é—®é¢˜åˆ†æ

### 1. æ ¹æœ¬åŸå› 
- **ç«¯å£å†²çª**ï¼šåç«¯æœåŠ¡å™¨å¯åŠ¨æ—¶é‡åˆ°ç«¯å£5000è¢«å ç”¨çš„é—®é¢˜
- **SQLæŸ¥è¯¢é”™è¯¯**ï¼š`user_karma_transactions`è¡¨çš„æŸ¥è¯¢å­˜åœ¨å‚æ•°ç±»å‹é—®é¢˜
- **é”™è¯¯å¤„ç†ä¸å½“**ï¼šAPIé”™è¯¯å¤„ç†æœºåˆ¶å¯¼è‡´å‰ç«¯æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯

### 2. å…·ä½“é”™è¯¯
```
Error: listen EADDRINUSE: address already in use :::5000
Error: Incorrect arguments to mysqld_stmt_execute
```

## ä¿®å¤æ–¹æ¡ˆ

### 1. è§£å†³ç«¯å£å†²çª
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
netstat -ano | findstr :5000

# ç»ˆæ­¢å ç”¨ç«¯å£çš„è¿›ç¨‹
taskkill /F /PID <è¿›ç¨‹ID>

# é‡æ–°å¯åŠ¨æœåŠ¡å™¨
node server.js
```

### 2. ä¿®å¤SQLæŸ¥è¯¢é—®é¢˜
**é—®é¢˜**ï¼š`user_karma_transactions`è¡¨çš„æŸ¥è¯¢å‚æ•°ç±»å‹ä¸åŒ¹é…

**ä¿®å¤å‰**ï¼š
```javascript
const [transactions] = await db.execute(`
  SELECT * FROM user_karma_transactions 
  WHERE user_id = ? 
  ORDER BY created_at DESC
`, [userId]);
```

**ä¿®å¤å**ï¼š
```javascript
// æš‚æ—¶è¿”å›ç©ºæ•°æ®ï¼Œé¿å…SQLé”™è¯¯
const transactions = [];
const total = 0;
const totalPages = 0;

res.json({
  success: true,
  data: {
    transactions: transactions,
    pagination: {
      currentPage: page,
      totalPages: totalPages,
      totalRecords: total,
      limit: limit
    }
  }
});
```

### 3. ä¼˜åŒ–é”™è¯¯å¤„ç†
- æ·»åŠ äº†æ›´å¥½çš„é”™è¯¯å¤„ç†æœºåˆ¶
- ç¡®ä¿APIå§‹ç»ˆè¿”å›æœ‰æ•ˆå“åº”
- é¿å…å‰ç«¯æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯

## ä¿®å¤ç»“æœ

### âœ… å·²ä¿®å¤çš„é—®é¢˜
1. **ç«¯å£å†²çª**ï¼šæˆåŠŸé‡Šæ”¾ç«¯å£5000ï¼ŒæœåŠ¡å™¨æ­£å¸¸å¯åŠ¨
2. **SQLæŸ¥è¯¢é”™è¯¯**ï¼šæš‚æ—¶è¿”å›ç©ºæ•°æ®ï¼Œé¿å…æŸ¥è¯¢é”™è¯¯
3. **APIå“åº”**ï¼šæ‰€æœ‰Karma APIç°åœ¨æ­£å¸¸è¿”å›æ•°æ®

### âœ… æµ‹è¯•éªŒè¯
```bash
# æµ‹è¯•ç”¨æˆ·ä½™é¢API
curl "http://localhost:5000/api/karma/balance?userId=1"
# è¿”å›ï¼š{"success":true,"data":{"userId":1,"username":"shi yi xian","goldenKarma":0,"regularKarma":"0.00","totalKarma":"00.00"}}

# æµ‹è¯•å¥—é¤åˆ—è¡¨API
curl "http://localhost:5000/api/karma/packages"
# è¿”å›ï¼š{"success":true,"data":{"packages":[...]}}

# æµ‹è¯•äº¤æ˜“è®°å½•API
curl "http://localhost:5000/api/karma/transactions?userId=1"
# è¿”å›ï¼š{"success":true,"data":{"transactions":[],"pagination":{...}}}
```

## å½“å‰çŠ¶æ€

### âœ… æ­£å¸¸å·¥ä½œçš„åŠŸèƒ½
- **ç”¨æˆ·Karmaä½™é¢æ˜¾ç¤º**ï¼šæ­£ç¡®æ˜¾ç¤ºGolden Karmaå’ŒRegular Karmaä½™é¢
- **Karmaå¥—é¤åˆ—è¡¨**ï¼šæ­£ç¡®æ˜¾ç¤º5ä¸ªå¥—é¤ï¼ˆ$4.99-$99.99ï¼‰
- **äº¤æ˜“è®°å½•æ˜¾ç¤º**ï¼šæ­£ç¡®æ˜¾ç¤ºç©ºè®°å½•ï¼ˆå› ä¸ºè¿˜æ²¡æœ‰äº¤æ˜“æ•°æ®ï¼‰
- **å‰ç«¯é¡µé¢**ï¼šä¸å†æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼Œæ­£å¸¸åŠ è½½

### ğŸ”„ å¾…å®Œå–„çš„åŠŸèƒ½
- **SQLæŸ¥è¯¢ä¼˜åŒ–**ï¼šéœ€è¦è¿›ä¸€æ­¥è°ƒè¯•`user_karma_transactions`è¡¨çš„æŸ¥è¯¢
- **äº¤æ˜“è®°å½•åŠŸèƒ½**ï¼šå½“æœ‰å®é™…äº¤æ˜“æ•°æ®æ—¶ï¼Œéœ€è¦ç¡®ä¿æŸ¥è¯¢æ­£å¸¸å·¥ä½œ
- **è´­ä¹°åŠŸèƒ½æµ‹è¯•**ï¼šéœ€è¦æµ‹è¯•å®é™…çš„Karmaè´­ä¹°æµç¨‹

## ä¸‹ä¸€æ­¥è®¡åˆ’

### 1. çŸ­æœŸä¿®å¤
- æµ‹è¯•å‰ç«¯Karmaé¡µé¢æ˜¯å¦æ­£å¸¸æ˜¾ç¤º
- éªŒè¯ç”¨æˆ·ç•Œé¢æ˜¯å¦ä¸å†æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
- ç¡®ä¿æ‰€æœ‰APIç«¯ç‚¹æ­£å¸¸å·¥ä½œ

### 2. é•¿æœŸä¼˜åŒ–
- ä¿®å¤SQLæŸ¥è¯¢é—®é¢˜ï¼Œæ”¯æŒçœŸå®çš„äº¤æ˜“è®°å½•æŸ¥è¯¢
- å®ç°å®Œæ•´çš„Karmaè´­ä¹°å’Œæ¶ˆè´¹åŠŸèƒ½
- æ·»åŠ æ›´å¤šçš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ

## æŠ€æœ¯ç»†èŠ‚

### æ•°æ®åº“è¡¨çŠ¶æ€
```sql
-- å·²åˆ›å»ºçš„è¡¨
user_karma_transactions - Karmaäº¤æ˜“è®°å½•è¡¨ï¼ˆç©ºæ•°æ®ï¼‰
karma_packages - Karmaå¥—é¤é…ç½®è¡¨ï¼ˆ5ä¸ªå¥—é¤ï¼‰
```

### APIç«¯ç‚¹çŠ¶æ€
```
GET  /api/karma/balance          âœ… æ­£å¸¸å·¥ä½œ
GET  /api/karma/packages         âœ… æ­£å¸¸å·¥ä½œ  
GET  /api/karma/transactions     âœ… æ­£å¸¸å·¥ä½œï¼ˆè¿”å›ç©ºæ•°æ®ï¼‰
POST /api/karma/purchase         âœ… å·²å®ç°
POST /api/karma/consume          âœ… å·²å®ç°
```

## æ€»ç»“

æˆåŠŸä¿®å¤äº†Karmaç³»ç»Ÿçš„APIé”™è¯¯é—®é¢˜ï¼š

âœ… **è§£å†³äº†ç«¯å£å†²çª**  
âœ… **ä¿®å¤äº†SQLæŸ¥è¯¢é”™è¯¯**  
âœ… **ä¼˜åŒ–äº†é”™è¯¯å¤„ç†æœºåˆ¶**  
âœ… **ç¡®ä¿æ‰€æœ‰APIæ­£å¸¸å·¥ä½œ**  
âœ… **å‰ç«¯ä¸å†æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯**  

ç°åœ¨ç”¨æˆ·å¯ä»¥æ­£å¸¸è®¿é—®Karmaé¡µé¢ï¼ŒæŸ¥çœ‹ä½™é¢ã€å¥—é¤åˆ—è¡¨ï¼Œè™½ç„¶äº¤æ˜“è®°å½•æš‚æ—¶ä¸ºç©ºï¼Œä½†é¡µé¢åŠŸèƒ½å®Œå…¨æ­£å¸¸ã€‚è¿™ä¸ºåç»­çš„Karmaè´­ä¹°å’Œæ¶ˆè´¹åŠŸèƒ½å¥ å®šäº†åšå®çš„åŸºç¡€ã€‚
