<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试书签API功能</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .status-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .closed {
            background-color: #ff6b6b;
            color: white;
        }
        .open {
            background-color: #28a745;
            color: white;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>测试书签API功能</h1>
        <p>此页面用于测试bookmark表的功能，包括书签关闭状态和通知设置</p>
        
        <div class="grid">
            <div>
                <h3>基本设置</h3>
                <div class="form-group">
                    <label for="userId">用户ID:</label>
                    <input type="number" id="userId" value="1003">
                </div>
                
                <div class="form-group">
                    <label for="novelId">小说ID:</label>
                    <input type="number" id="novelId" value="10">
                </div>
                
                <div class="form-group">
                    <label for="novelName">小说名称:</label>
                    <input type="text" id="novelName" value="西游记">
                </div>
                
                <div class="form-group">
                    <label for="bookmarkClosed">书签关闭状态:</label>
                    <select id="bookmarkClosed">
                        <option value="0">开启 (0)</option>
                        <option value="1">关闭 (1)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="notificationOff">通知关闭状态:</label>
                    <select id="notificationOff">
                        <option value="0">开启 (0)</option>
                        <option value="1">关闭 (1)</option>
                    </select>
                </div>
            </div>
            
            <div>
                <h3>操作按钮</h3>
                <button onclick="createOrUpdateBookmark()">创建/更新书签</button>
                <button onclick="getUserBookmarks()">获取用户书签</button>
                <button onclick="getBookmarkStatus()">获取书签状态</button>
                <button onclick="toggleBookmark()">切换书签状态</button>
                <button onclick="toggleNotification()">切换通知状态</button>
                <button onclick="deleteBookmark()">删除书签</button>
            </div>
        </div>
        
        <div id="result" class="result" style="display: none;"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';
        
        function getFormData() {
            return {
                user_id: parseInt(document.getElementById('userId').value),
                novel_id: parseInt(document.getElementById('novelId').value),
                novel_name: document.getElementById('novelName').value,
                bookmark_closed: parseInt(document.getElementById('bookmarkClosed').value),
                notification_off: parseInt(document.getElementById('notificationOff').value)
            };
        }
        
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `result ${type}`;
            element.style.display = 'block';
        }
        
        function getStatusIndicator(closed) {
            return `<span class="status-indicator ${closed ? 'closed' : 'open'}">${closed ? '关闭' : '开启'}</span>`;
        }
        
        async function createOrUpdateBookmark() {
            const data = getFormData();
            try {
                const response = await fetch(`${API_BASE}/bookmark/create-or-update`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                
                const message = `创建/更新书签结果:
成功: ${result.success}
消息: ${result.message}
书签ID: ${result.bookmark_id || '未知'}
书签状态: ${getStatusIndicator(data.bookmark_closed)}
通知状态: ${getStatusIndicator(data.notification_off)}
时间: ${new Date().toLocaleString()}`;
                
                showResult('result', message, result.success ? 'success' : 'error');
            } catch (error) {
                showResult('result', `错误: ${error.message}`, 'error');
            }
        }
        
        async function getUserBookmarks() {
            const userId = document.getElementById('userId').value;
            try {
                const response = await fetch(`${API_BASE}/bookmark/user/${userId}`);
                const result = await response.json();
                
                let message = `用户书签列表结果:
成功: ${result.success}
书签数量: ${result.data ? result.data.length : 0}

书签详情:`;
                
                if (result.data && result.data.length > 0) {
                    result.data.forEach((bookmark, index) => {
                        message += `
${index + 1}. 小说: ${bookmark.novel_name} (ID: ${bookmark.novel_id})
   书签状态: ${getStatusIndicator(bookmark.bookmark_closed)}
   通知状态: ${getStatusIndicator(bookmark.notification_off)}
   创建时间: ${bookmark.created_at}
   更新时间: ${bookmark.updated_at}`;
                    });
                }
                
                showResult('result', message, result.success ? 'success' : 'error');
            } catch (error) {
                showResult('result', `错误: ${error.message}`, 'error');
            }
        }
        
        async function getBookmarkStatus() {
            const data = getFormData();
            try {
                const response = await fetch(`${API_BASE}/bookmark/status/${data.user_id}/${data.novel_id}`);
                const result = await response.json();
                
                const message = `书签状态检查结果:
成功: ${result.success}
用户ID: ${data.user_id}
小说ID: ${data.novel_id}
小说名称: ${result.data ? result.data.novel_name : '未知'}
书签状态: ${getStatusIndicator(result.data ? result.data.bookmark_closed : 0)}
通知状态: ${getStatusIndicator(result.data ? result.data.notification_off : 0)}
创建时间: ${result.data ? result.data.created_at : '未知'}
更新时间: ${result.data ? result.data.updated_at : '未知'}
时间: ${new Date().toLocaleString()}`;
                
                showResult('result', message, result.success ? 'success' : 'error');
            } catch (error) {
                showResult('result', `错误: ${error.message}`, 'error');
            }
        }
        
        async function toggleBookmark() {
            const data = getFormData();
            try {
                const response = await fetch(`${API_BASE}/bookmark/toggle-bookmark`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_id: data.user_id,
                        novel_id: data.novel_id,
                        novel_name: data.novel_name
                    })
                });
                const result = await response.json();
                
                const message = `切换书签状态结果:
成功: ${result.success}
消息: ${result.message}
新书签状态: ${getStatusIndicator(result.bookmark_closed)}
时间: ${new Date().toLocaleString()}`;
                
                showResult('result', message, result.success ? 'success' : 'error');
            } catch (error) {
                showResult('result', `错误: ${error.message}`, 'error');
            }
        }
        
        async function toggleNotification() {
            const data = getFormData();
            try {
                const response = await fetch(`${API_BASE}/bookmark/toggle-notification`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_id: data.user_id,
                        novel_id: data.novel_id,
                        novel_name: data.novel_name
                    })
                });
                const result = await response.json();
                
                const message = `切换通知状态结果:
成功: ${result.success}
消息: ${result.message}
新通知状态: ${getStatusIndicator(result.notification_off)}
时间: ${new Date().toLocaleString()}`;
                
                showResult('result', message, result.success ? 'success' : 'error');
            } catch (error) {
                showResult('result', `错误: ${error.message}`, 'error');
            }
        }
        
        async function deleteBookmark() {
            const data = getFormData();
            try {
                const response = await fetch(`${API_BASE}/bookmark/${data.user_id}/${data.novel_id}`, {
                    method: 'DELETE'
                });
                const result = await response.json();
                
                const message = `删除书签结果:
成功: ${result.success}
消息: ${result.message}
时间: ${new Date().toLocaleString()}`;
                
                showResult('result', message, result.success ? 'success' : 'error');
            } catch (error) {
                showResult('result', `错误: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>
