# åå°èœå•æƒé™è¦†ç›–èŒƒå›´åˆ†ææŠ¥å‘Šï¼ˆç¬¬äºŒè½®ï¼‰

## 1. å·¦ä¾§å¯¼èˆªå®Œæ•´ç»“æ„ï¼ˆæ‰€æœ‰åˆ†ç»„ + æ‰€æœ‰èœå•é¡¹ï¼‰

åŸºäº `frontend/src/pages/AdminPanel.tsx` ç¬¬ 1658-1728 è¡Œçš„å·¦ä¾§å¯¼èˆªä»£ç åˆ†æï¼š

### ç»„ï¼šé»˜è®¤ç»„ï¼ˆé¡¶éƒ¨ç‹¬ç«‹èœå•é¡¹ï¼Œä¸å¯æŠ˜å ï¼‰

**å®¹å™¨ç±»å‹**ï¼š`<div className={styles.navItem}>`ï¼ˆç‹¬ç«‹èœå•é¡¹ï¼Œéåˆ†ç»„ï¼‰

**å±•å¼€/æŠ˜å çŠ¶æ€**ï¼šæ— ï¼ˆå•é¡¹èœå•ï¼Œæ— æŠ˜å åŠŸèƒ½ï¼‰

**å­èœå•é¡¹**ï¼š

1. **å°è¯´å®¡æ‰¹**
   - æ˜¾ç¤ºåç§°ï¼šå°è¯´å®¡æ‰¹
   - activeTabï¼š`'novel-review'`
   - menuKeyï¼š**æ— **ï¼ˆç¡¬ç¼–ç ï¼Œæœªä½¿ç”¨ menuKeyï¼‰
   - å›¾æ ‡ï¼šğŸ“š
   - ä»£ç ä½ç½®ï¼šç¬¬ 1659-1664 è¡Œ

2. **æ–°å°è¯´æ± **
   - æ˜¾ç¤ºåç§°ï¼šæ–°å°è¯´æ± 
   - activeTabï¼š`'new-novel-pool'`
   - menuKeyï¼š**æ— **ï¼ˆç¡¬ç¼–ç ï¼Œæœªä½¿ç”¨ menuKeyï¼‰
   - å›¾æ ‡ï¼šğŸ“–
   - ä»£ç ä½ç½®ï¼šç¬¬ 1665-1670 è¡Œ

3. **ç« èŠ‚å®¡æ‰¹**
   - æ˜¾ç¤ºåç§°ï¼šç« èŠ‚å®¡æ‰¹
   - activeTabï¼š`'chapter-approval'`
   - menuKeyï¼š**æ— **ï¼ˆç¡¬ç¼–ç ï¼Œæœªä½¿ç”¨ menuKeyï¼‰
   - å›¾æ ‡ï¼šâœ…
   - ä»£ç ä½ç½®ï¼šç¬¬ 1671-1676 è¡Œ

### ç»„ï¼šæ”¶ç›Šä¸ç¼–è¾‘ç®¡ç†ï¼ˆå¯æŠ˜å åˆ†ç»„ï¼‰

**å®¹å™¨ç±»å‹**ï¼š`<div className={styles.navGroup}>`ï¼ˆåˆ†ç»„å®¹å™¨ï¼‰

**å±•å¼€/æŠ˜å çŠ¶æ€**ï¼šæœ‰ï¼ˆä½¿ç”¨ `incomeAndEditorMenuExpanded` çŠ¶æ€å˜é‡æ§åˆ¶ï¼Œç¬¬ 102 è¡Œï¼‰

**æƒé™æ§åˆ¶**ï¼š**å·²çº³å…¥æƒé™ä½“ç³»**ï¼ˆä½¿ç”¨ `hasMenuPermission` å‡½æ•°è¿‡æ»¤ï¼‰

**ä»£ç ä½ç½®**ï¼šç¬¬ 1677-1719 è¡Œ

**å­èœå•é¡¹**ï¼ˆå…± 10 é¡¹ï¼Œå…¨éƒ¨æœ‰ menuKeyï¼‰ï¼š

1. **è´¹ç”¨ç»Ÿè®¡**
   - æ˜¾ç¤ºåç§°ï¼šè´¹ç”¨ç»Ÿè®¡
   - activeTabï¼š`'payment-stats'`
   - menuKeyï¼š`'payment-stats'` âœ…
   - å›¾æ ‡ï¼šğŸ’°

2. **ä½œè€…æ”¶å…¥ç»Ÿè®¡**
   - æ˜¾ç¤ºåç§°ï¼šä½œè€…æ”¶å…¥ç»Ÿè®¡
   - activeTabï¼š`'author-income'`
   - menuKeyï¼š`'author-income'` âœ…
   - å›¾æ ‡ï¼šâœï¸

3. **è¯»è€…æ”¶å…¥ç»Ÿè®¡**
   - æ˜¾ç¤ºåç§°ï¼šè¯»è€…æ”¶å…¥ç»Ÿè®¡
   - activeTabï¼š`'reader-income'`
   - menuKeyï¼š`'reader-income'` âœ…
   - å›¾æ ‡ï¼šğŸ‘¥

4. **ç»“ç®—æ€»è§ˆ**
   - æ˜¾ç¤ºåç§°ï¼šç»“ç®—æ€»è§ˆ
   - activeTabï¼š`'settlement-overview'`
   - menuKeyï¼š`'settlement-overview'` âœ…
   - å›¾æ ‡ï¼šğŸ’³

5. **åŸºç¡€æ”¶å…¥ç»Ÿè®¡-1**
   - æ˜¾ç¤ºåç§°ï¼šåŸºç¡€æ”¶å…¥ç»Ÿè®¡-1
   - activeTabï¼š`'base-income'`
   - menuKeyï¼š`'base-income'` âœ…
   - å›¾æ ‡ï¼šğŸ“Š

6. **ä½œè€…åŸºç¡€æ”¶å…¥è¡¨-2**
   - æ˜¾ç¤ºåç§°ï¼šä½œè€…åŸºç¡€æ”¶å…¥è¡¨-2
   - activeTabï¼š`'author-royalty'`
   - menuKeyï¼š`'author-royalty'` âœ…
   - å›¾æ ‡ï¼šğŸ’µ

7. **æ¨å¹¿ä½£é‡‘æ˜ç»†-3**
   - æ˜¾ç¤ºåç§°ï¼šæ¨å¹¿ä½£é‡‘æ˜ç»†-3
   - activeTabï¼š`'commission-transaction'`
   - menuKeyï¼š`'commission-transaction'` âœ…
   - å›¾æ ‡ï¼šğŸ’°

8. **ç¼–è¾‘åŸºç¡€æ”¶å…¥-4**
   - æ˜¾ç¤ºåç§°ï¼šç¼–è¾‘åŸºç¡€æ”¶å…¥-4
   - activeTabï¼š`'editor-base-income'`
   - menuKeyï¼š`'editor-base-income'` âœ…
   - å›¾æ ‡ï¼šğŸ“

9. **ææˆè®¾ç½®**
   - æ˜¾ç¤ºåç§°ï¼šææˆè®¾ç½®
   - activeTabï¼š`'commission-settings'`
   - menuKeyï¼š`'commission-settings'` âœ…
   - å›¾æ ‡ï¼šâš™ï¸

10. **ç¼–è¾‘ç®¡ç†**
    - æ˜¾ç¤ºåç§°ï¼šç¼–è¾‘ç®¡ç†
    - activeTabï¼š`'editor-management'`
    - menuKeyï¼š`'editor-management'` âœ…
    - å›¾æ ‡ï¼šğŸ‘¥

**åˆ†ç»„æ ‡è¯†**ï¼š
- groupKeyï¼š`'group:income-editor'` âœ…ï¼ˆå·²çº³å…¥æƒé™æ§åˆ¶ï¼‰

### ç»„ï¼šé»˜è®¤ç»„ï¼ˆåº•éƒ¨ç‹¬ç«‹èœå•é¡¹ï¼Œä¸å¯æŠ˜å ï¼‰

**å®¹å™¨ç±»å‹**ï¼š`<div className={styles.navItem}>`ï¼ˆç‹¬ç«‹èœå•é¡¹ï¼Œéåˆ†ç»„ï¼‰

**å±•å¼€/æŠ˜å çŠ¶æ€**ï¼šæ— ï¼ˆå•é¡¹èœå•ï¼Œæ— æŠ˜å åŠŸèƒ½ï¼‰

**å­èœå•é¡¹**ï¼š

1. **æˆ‘çš„æ”¶æ¬¾è´¦æˆ·**
   - æ˜¾ç¤ºåç§°ï¼šæˆ‘çš„æ”¶æ¬¾è´¦æˆ·
   - activeTabï¼š`'admin-payout-account'`
   - menuKeyï¼š**æ— **ï¼ˆç¡¬ç¼–ç ï¼Œæœªä½¿ç”¨ menuKeyï¼‰
   - å›¾æ ‡ï¼šğŸ’³
   - ä»£ç ä½ç½®ï¼šç¬¬ 1721-1727 è¡Œ

---

## 2. adminMenuConfig ä¸­çš„æƒé™èœå•é…ç½®ç°çŠ¶

**æ–‡ä»¶è·¯å¾„**ï¼š`frontend/src/pages/adminMenuConfig.ts`

### å½“å‰é…ç½®å†…å®¹

**å·²é…ç½®çš„åˆ†ç»„**ï¼š
- ä»… **1 ä¸ªåˆ†ç»„**ï¼š`incomeEditorMenuGroup`ï¼ˆæ”¶ç›Šä¸ç¼–è¾‘ç®¡ç†ï¼‰

**ç±»å‹å®šä¹‰**ï¼š

1. **`AdminMenuItemKey`**ï¼ˆç¬¬ 6-16 è¡Œï¼‰ï¼š
   ```typescript
   export type AdminMenuItemKey =
     | 'payment-stats'
     | 'author-income'
     | 'reader-income'
     | 'settlement-overview'
     | 'base-income'
     | 'author-royalty'
     | 'commission-transaction'
     | 'editor-base-income'
     | 'commission-settings'
     | 'editor-management';
   ```
   - **åŒ…å« 10 ä¸ªèœå•é¡¹ key**ï¼Œå…¨éƒ¨å±äº"æ”¶ç›Šä¸ç¼–è¾‘ç®¡ç†"åˆ†ç»„

2. **`AdminMenuGroupKey`**ï¼ˆç¬¬ 18-19 è¡Œï¼‰ï¼š
   ```typescript
   export type AdminMenuGroupKey =
     | 'group:income-editor';
   ```
   - **ä»…åŒ…å« 1 ä¸ªåˆ†ç»„ key**ï¼š`'group:income-editor'`

3. **`ALL_MENU_KEYS`**ï¼ˆç¬¬ 57-60 è¡Œï¼‰ï¼š
   ```typescript
   export const ALL_MENU_KEYS: string[] = [
     'group:income-editor',
     ...incomeEditorMenuGroup.items.map(i => i.key)
   ];
   ```
   - **åŒ…å« 11 ä¸ª key**ï¼š
     - 1 ä¸ªåˆ†ç»„ keyï¼š`'group:income-editor'`
     - 10 ä¸ªèœå•é¡¹ keyï¼š`'payment-stats'`, `'author-income'`, `'reader-income'`, `'settlement-overview'`, `'base-income'`, `'author-royalty'`, `'commission-transaction'`, `'editor-base-income'`, `'commission-settings'`, `'editor-management'`

### é…ç½®èŒƒå›´æ€»ç»“

**ç›®å‰å‚ä¸æƒé™æ§åˆ¶çš„èœå• key**ï¼š
- ä»…è¦†ç›–"æ”¶ç›Šä¸ç¼–è¾‘ç®¡ç†"åˆ†ç»„ä¸‹çš„ **10 ä¸ªèœå•é¡¹**
- ä¸åŒ…å«ï¼šå°è¯´å®¡æ‰¹ã€æ–°å°è¯´æ± ã€ç« èŠ‚å®¡æ‰¹ã€æˆ‘çš„æ”¶æ¬¾è´¦æˆ·

**ç›®å‰å‚ä¸æƒé™æ§åˆ¶çš„ group key**ï¼š
- ä»… **1 ä¸ª**ï¼š`'group:income-editor'`
- ä¸åŒ…å«å…¶ä»–åˆ†ç»„çš„ groupKeyï¼ˆå› ä¸ºå…¶ä»–èœå•é¡¹éƒ½æ˜¯ç‹¬ç«‹é¡¹ï¼Œæœªå½¢æˆåˆ†ç»„ï¼‰

**ç»“è®º**ï¼š
- âœ… **å·²é…ç½®**ï¼šæ”¶ç›Šä¸ç¼–è¾‘ç®¡ç†åˆ†ç»„åŠå…¶ 10 ä¸ªå­èœå•é¡¹
- âŒ **æœªé…ç½®**ï¼šå°è¯´å®¡æ‰¹ã€æ–°å°è¯´æ± ã€ç« èŠ‚å®¡æ‰¹ã€æˆ‘çš„æ”¶æ¬¾è´¦æˆ·ï¼ˆè¿™ 4 ä¸ªç‹¬ç«‹èœå•é¡¹ï¼‰

---

## 3. å‰ç«¯èœå•æƒé™ä½¿ç”¨èŒƒå›´ï¼ˆå“ªäº›èœå•çœŸæ­£è¢«éšè—/æ˜¾ç¤ºæ§åˆ¶ï¼‰

**åˆ†æä½ç½®**ï¼š`frontend/src/pages/AdminPanel.tsx`

### æƒé™ç›¸å…³çŠ¶æ€å’Œå‡½æ•°

1. **çŠ¶æ€å˜é‡**ï¼ˆç¬¬ 105 è¡Œï¼‰ï¼š
   ```typescript
   const [allowedMenuKeys, setAllowedMenuKeys] = useState<string[] | null>(null);
   ```

2. **æƒé™è·å–**ï¼ˆç¬¬ 319-348 è¡Œï¼‰ï¼š
   - åœ¨ `useEffect` ä¸­è¯·æ±‚ `/api/admin/menu-permissions/my`
   - è·å–æˆåŠŸåè®¾ç½® `allowedMenuKeys`

3. **æƒé™åˆ¤æ–­å‡½æ•°**ï¼ˆç¬¬ 351-356 è¡Œï¼‰ï¼š
   ```typescript
   const hasMenuPermission = (menuKey: string) => {
     if (!allowedMenuKeys) return true; // åˆå§‹çŠ¶æ€å…ˆä¸é™åˆ¶
     // super_admin å…œåº•é€»è¾‘ï¼Œå¦‚æœå½“å‰è§’è‰²æ˜¯ super_adminï¼Œå°±ç›´æ¥æ”¾è¡Œ
     if (currentAdminRole === 'super_admin') return true;
     return allowedMenuKeys.includes(menuKey);
   };
   ```

### hasMenuPermission çš„è°ƒç”¨ä½ç½®

**æœç´¢ç»“æœæ˜¾ç¤º**ï¼ˆgrep ç»“æœï¼‰ï¼š
- ç¬¬ 1682 è¡Œï¼š`const visibleItems = group.items.filter(item => hasMenuPermission(item.key));`
- ç¬¬ 1685 è¡Œï¼š`const groupVisible = hasMenuPermission(group.groupKey) && visibleItems.length > 0;`

**åˆ†æ**ï¼š
- `hasMenuPermission` **ä»…åœ¨"æ”¶ç›Šä¸ç¼–è¾‘ç®¡ç†"åˆ†ç»„æ¸²æŸ“æ—¶è¢«è°ƒç”¨**ï¼ˆç¬¬ 1678-1719 è¡Œï¼‰
- ç”¨äºï¼š
  1. è¿‡æ»¤åˆ†ç»„ä¸‹çš„å¯è§å­èœå•é¡¹ï¼ˆç¬¬ 1682 è¡Œï¼‰
  2. åˆ¤æ–­åˆ†ç»„æœ¬èº«æ˜¯å¦å¯è§ï¼ˆç¬¬ 1685 è¡Œï¼ŒåŒæ—¶æ£€æŸ¥ `groupKey` å’Œå­èœå•é¡¹ï¼‰

### æƒé™æ§åˆ¶è¦†ç›–èŒƒå›´

**å·²å— `hasMenuPermission` æ§åˆ¶çš„èœå•**ï¼š

1. âœ… **æ”¶ç›Šä¸ç¼–è¾‘ç®¡ç†åˆ†ç»„**ï¼ˆgroupKeyï¼š`'group:income-editor'`ï¼‰
   - åˆ†ç»„æ ‡é¢˜æœ¬èº«ï¼šé€šè¿‡ `hasMenuPermission(group.groupKey)` åˆ¤æ–­
   - åˆ†ç»„ä¸‹æ‰€æœ‰å­èœå•é¡¹ï¼šé€šè¿‡ `hasMenuPermission(item.key)` è¿‡æ»¤

**ä¸å—æƒé™æ§åˆ¶çš„èœå•**ï¼ˆæ€»æ˜¯æ˜¾ç¤ºï¼‰ï¼š

1. âŒ **å°è¯´å®¡æ‰¹**ï¼ˆç¬¬ 1659-1664 è¡Œï¼‰
   - ç¡¬ç¼–ç æ¸²æŸ“ï¼Œæ— æƒé™åˆ¤æ–­
   - æ‰€æœ‰è§’è‰²ç™»å½•åéƒ½å¯è§

2. âŒ **æ–°å°è¯´æ± **ï¼ˆç¬¬ 1665-1670 è¡Œï¼‰
   - ç¡¬ç¼–ç æ¸²æŸ“ï¼Œæ— æƒé™åˆ¤æ–­
   - æ‰€æœ‰è§’è‰²ç™»å½•åéƒ½å¯è§

3. âŒ **ç« èŠ‚å®¡æ‰¹**ï¼ˆç¬¬ 1671-1676 è¡Œï¼‰
   - ç¡¬ç¼–ç æ¸²æŸ“ï¼Œæ— æƒé™åˆ¤æ–­
   - æ‰€æœ‰è§’è‰²ç™»å½•åéƒ½å¯è§

4. âŒ **æˆ‘çš„æ”¶æ¬¾è´¦æˆ·**ï¼ˆç¬¬ 1721-1727 è¡Œï¼‰
   - ç¡¬ç¼–ç æ¸²æŸ“ï¼Œæ— æƒé™åˆ¤æ–­
   - æ‰€æœ‰è§’è‰²ç™»å½•åéƒ½å¯è§

### æƒé™æ§åˆ¶é€»è¾‘ç»†èŠ‚

**åˆ†ç»„å¯è§æ€§åˆ¤æ–­**ï¼ˆç¬¬ 1685 è¡Œï¼‰ï¼š
```typescript
const groupVisible = hasMenuPermission(group.groupKey) && visibleItems.length > 0;
```

**é€»è¾‘è¯´æ˜**ï¼š
- åˆ†ç»„å¯è§éœ€è¦åŒæ—¶æ»¡è¶³ï¼š
  1. åˆ†ç»„ keyï¼ˆ`group:income-editor`ï¼‰åœ¨ `allowedMenuKeys` ä¸­
  2. è‡³å°‘æœ‰ä¸€ä¸ªå­èœå•é¡¹æœ‰æƒé™ï¼ˆ`visibleItems.length > 0`ï¼‰
- å¦‚æœåˆ†ç»„ä¸‹æ‰€æœ‰å­èœå•éƒ½è¢«éšè—ï¼Œåˆ™æ•´ä¸ªåˆ†ç»„ä¸æ˜¾ç¤ºï¼ˆç¬¦åˆéœ€æ±‚ï¼‰

---

## 4. è´¦å·æƒé™ç®¡ç†é¡µé¢å½“å‰å¯é…ç½®çš„èœå•èŒƒå›´

**æ–‡ä»¶è·¯å¾„**ï¼š`frontend/src/pages/AdminPanel/AdminUserPage/PermissionManagementTab.tsx`

### UI æ¸²æŸ“é€»è¾‘

**é…ç½®æ¥æº**ï¼ˆç¬¬ 3 è¡Œï¼‰ï¼š
```typescript
import { incomeEditorMenuGroup, ALL_MENU_KEYS } from '../../adminMenuConfig';
```

**æ¸²æŸ“çš„åˆ†ç»„**ï¼ˆç¬¬ 125-127 è¡Œï¼‰ï¼š
```typescript
const group = incomeEditorMenuGroup;
const groupItems = group.items;
const groupKey = group.groupKey;
```

**UI ç»“æ„**ï¼ˆç¬¬ 161-198 è¡Œï¼‰ï¼š
- ä»…æ¸²æŸ“ **1 ä¸ªæƒé™é…ç½®å¡ç‰‡**ï¼š`incomeEditorMenuGroup`
- å¡ç‰‡åŒ…å«ï¼š
  1. åˆ†ç»„æ ‡é¢˜ + "å…¨éƒ¨å¯è§"æ€»å¼€å…³ï¼ˆç¬¬ 163-179 è¡Œï¼‰
  2. 10 ä¸ªå­èœå•é¡¹çš„ checkbox åˆ—è¡¨ï¼ˆç¬¬ 182-197 è¡Œï¼‰

### å¯é…ç½®çš„ menuKey åˆ—è¡¨

**å½“å‰å¯ä»¥è¢«æ‰“å‹¾/å–æ¶ˆçš„ menuKey**ï¼ˆå…± 11 ä¸ªï¼‰ï¼š

1. **åˆ†ç»„ key**ï¼š
   - `'group:income-editor'`ï¼ˆé€šè¿‡"å…¨éƒ¨å¯è§"æ€»å¼€å…³æ§åˆ¶ï¼‰

2. **èœå•é¡¹ key**ï¼ˆ10 ä¸ªï¼‰ï¼š
   - `'payment-stats'`ï¼ˆè´¹ç”¨ç»Ÿè®¡ï¼‰
   - `'author-income'`ï¼ˆä½œè€…æ”¶å…¥ç»Ÿè®¡ï¼‰
   - `'reader-income'`ï¼ˆè¯»è€…æ”¶å…¥ç»Ÿè®¡ï¼‰
   - `'settlement-overview'`ï¼ˆç»“ç®—æ€»è§ˆï¼‰
   - `'base-income'`ï¼ˆåŸºç¡€æ”¶å…¥ç»Ÿè®¡-1ï¼‰
   - `'author-royalty'`ï¼ˆä½œè€…åŸºç¡€æ”¶å…¥è¡¨-2ï¼‰
   - `'commission-transaction'`ï¼ˆæ¨å¹¿ä½£é‡‘æ˜ç»†-3ï¼‰
   - `'editor-base-income'`ï¼ˆç¼–è¾‘åŸºç¡€æ”¶å…¥-4ï¼‰
   - `'commission-settings'`ï¼ˆææˆè®¾ç½®ï¼‰
   - `'editor-management'`ï¼ˆç¼–è¾‘ç®¡ç†ï¼‰

### æƒé™æ•°æ®æ˜ å°„é€»è¾‘

**åŠ è½½æƒé™**ï¼ˆç¬¬ 17-58 è¡Œï¼‰ï¼š
1. è¯·æ±‚ `/api/admin/menu-permissions/role/:role`
2. è·å– `data.data.permissions`ï¼ˆæœåŠ¡ç«¯è¿”å›çš„æƒé™æ˜ å°„ï¼‰
3. ä½¿ç”¨ `ALL_MENU_KEYS` åˆå§‹åŒ–æœ¬åœ° `permissions` çŠ¶æ€ï¼ˆç¬¬ 42-44 è¡Œï¼‰ï¼š
   ```typescript
   ALL_MENU_KEYS.forEach(key => {
     map[key] = serverPermissions.hasOwnProperty(key) ? !!serverPermissions[key] : true;
   });
   ```
   - é»˜è®¤å€¼ï¼š`true`ï¼ˆå…¨éƒ¨å¯è§ï¼‰
   - å¦‚æœæœåŠ¡ç«¯æœ‰é…ç½®ï¼Œåˆ™ä½¿ç”¨æœåŠ¡ç«¯å€¼

**ä¿å­˜æƒé™**ï¼ˆç¬¬ 85-116 è¡Œï¼‰ï¼š
- å°†æ•´ä¸ª `permissions` å¯¹è±¡å‘é€åˆ°åç«¯
- åç«¯ä¼šå…¨é‡è¦†ç›–è¯¥è§’è‰²çš„æƒé™é…ç½®

### é…ç½®èŒƒå›´æ€»ç»“

**å½“å‰å¯é…ç½®èŒƒå›´**ï¼š
- âœ… **ä»…è¦†ç›–"æ”¶ç›Šä¸ç¼–è¾‘ç®¡ç†"åˆ†ç»„**ï¼ˆçº¢è‰²æ¡†åŒºåŸŸï¼‰
- âŒ **ä¸åŒ…å«**ï¼šå°è¯´å®¡æ‰¹ã€æ–°å°è¯´æ± ã€ç« èŠ‚å®¡æ‰¹ã€æˆ‘çš„æ”¶æ¬¾è´¦æˆ·

**UI å±•ç¤º**ï¼š
- åªæ˜¾ç¤º 1 ä¸ªæƒé™é…ç½®å¡ç‰‡
- å¡ç‰‡å†…åŒ…å« 1 ä¸ªåˆ†ç»„æ ‡é¢˜ + 10 ä¸ªèœå•é¡¹ checkbox
- æ²¡æœ‰å…¶ä»–åˆ†ç»„çš„é…ç½®ç•Œé¢

---

## 5. åç«¯èœå•æƒé™ API æ”¯æŒçš„ key èŒƒå›´

**åˆ†æä½ç½®**ï¼š`backend/routes/admin.js` ç¬¬ 12859-12990 è¡Œ

### ALL_MENU_KEYS å®šä¹‰

**åç«¯å®šä¹‰**ï¼ˆç¬¬ 12860-12875 è¡Œï¼‰ï¼š
```javascript
const ALL_MENU_KEYS = [
  // group keys
  'group:income-editor',
  // income & editor group items
  'payment-stats',
  'author-income',
  'reader-income',
  'settlement-overview',
  'base-income',
  'author-royalty',
  'commission-transaction',
  'editor-base-income',
  'commission-settings',
  'editor-management',
  // å…¶ä»–åˆ†ç»„çš„èœå• key å¯ä»¥åç»­ç»§ç»­è¡¥å……
];
```

**åŒ…å«çš„ key**ï¼ˆå…± 11 ä¸ªï¼‰ï¼š
- 1 ä¸ªåˆ†ç»„ keyï¼š`'group:income-editor'`
- 10 ä¸ªèœå•é¡¹ keyï¼šä¸å‰ç«¯ `ALL_MENU_KEYS` å®Œå…¨ä¸€è‡´

### å‰åç«¯ä¸€è‡´æ€§

**å¯¹æ¯”ç»“æœ**ï¼š
- âœ… **å®Œå…¨ä¸€è‡´**ï¼šåç«¯ `ALL_MENU_KEYS` ä¸å‰ç«¯ `ALL_MENU_KEYS` åŒ…å«çš„ key å®Œå…¨ç›¸åŒ
- âœ… **åŒæ­¥ç»´æŠ¤**ï¼šåç«¯ä»£ç ä¸­æœ‰æ³¨é‡Š"å…¶ä»–åˆ†ç»„çš„èœå• key å¯ä»¥åç»­ç»§ç»­è¡¥å……"ï¼Œè¯´æ˜è®¾è®¡ä¸Šæ”¯æŒæ‰©å±•

### API æ¥å£ä¸­çš„ä½¿ç”¨

1. **`GET /api/admin/menu-permissions/my`**ï¼ˆç¬¬ 12878-12905 è¡Œï¼‰ï¼š
   - ä½¿ç”¨ `ALL_MENU_KEYS` ä½œä¸ºå‚æ•°è°ƒç”¨ `getAdminAllowedMenuKeys`
   - è¿”å›å½“å‰ç®¡ç†å‘˜å¯è§çš„èœå• key åˆ—è¡¨

2. **`GET /api/admin/menu-permissions/role/:role`**ï¼ˆç¬¬ 12909-12945 è¡Œï¼‰ï¼š
   - è¿”å› `allMenuKeys: ALL_MENU_KEYS`ï¼ˆä¾›å‰ç«¯åˆå§‹åŒ– checkboxï¼‰
   - è¿”å› `permissions`ï¼ˆè¯¥è§’è‰²çš„æƒé™é…ç½®ï¼‰

3. **`POST /api/admin/menu-permissions/role/:role`**ï¼ˆç¬¬ 12949-12990 è¡Œï¼‰ï¼š
   - æ¥æ”¶ `permissions` å¯¹è±¡ï¼ˆå¯åŒ…å«ä»»æ„ menuKeyï¼‰
   - è°ƒç”¨ `saveRoleMenuPermissions` ä¿å­˜ï¼ˆæ”¯æŒä»»æ„ keyï¼Œä¸é™åˆ¶åœ¨ `ALL_MENU_KEYS` å†…ï¼‰

### æœåŠ¡å±‚æ”¯æŒèŒƒå›´

**`AdminMenuPermissionService`**ï¼ˆ`backend/services/adminMenuPermissionService.js`ï¼‰ï¼š

1. **`getRoleMenuPermissions(db, role)`**ï¼ˆç¬¬ 18-35 è¡Œï¼‰ï¼š
   - ä»æ•°æ®åº“æŸ¥è¯¢è¯¥è§’è‰²çš„æ‰€æœ‰æƒé™è®°å½•
   - **ä¸é™åˆ¶ key èŒƒå›´**ï¼Œè¿”å›æ•°æ®åº“ä¸­å­˜åœ¨çš„æ‰€æœ‰ `menu_key`

2. **`saveRoleMenuPermissions(db, role, permissionsMap)`**ï¼ˆç¬¬ 46-83 è¡Œï¼‰ï¼š
   - æ¥æ”¶ä»»æ„ `permissionsMap` å¯¹è±¡
   - **ä¸éªŒè¯ key æ˜¯å¦åœ¨ `ALL_MENU_KEYS` ä¸­**ï¼Œç›´æ¥ä¿å­˜åˆ°æ•°æ®åº“

3. **`getAdminAllowedMenuKeys(db, adminRole, allMenuKeys)`**ï¼ˆç¬¬ 94-122 è¡Œï¼‰ï¼š
   - æ¥æ”¶ `allMenuKeys` å‚æ•°ï¼ˆç”±è°ƒç”¨æ–¹ä¼ å…¥ï¼‰
   - åŸºäºä¼ å…¥çš„ `allMenuKeys` è®¡ç®—å¯è§èœå•
   - **è®¾è®¡ä¸Šæ”¯æŒä»»æ„ key åˆ—è¡¨**ï¼Œä¸ç¡¬ç¼–ç 

### åç«¯æ”¯æŒèŒƒå›´æ€»ç»“

**å½“å‰åç«¯ `ALL_MENU_KEYS` æ•°ç»„**ï¼š
- ä»…åŒ…å«"æ”¶ç›Šä¸ç¼–è¾‘ç®¡ç†"ç›¸å…³çš„ 11 ä¸ª key
- ä¸å‰ç«¯ `ALL_MENU_KEYS` å®Œå…¨ä¸€è‡´

**æœåŠ¡å±‚è®¾è®¡**ï¼š
- âœ… **æ”¯æŒæ‰©å±•**ï¼šæœåŠ¡å±‚å‡½æ•°ä¸ç¡¬ç¼–ç  key åˆ—è¡¨ï¼Œæ”¯æŒä¼ å…¥ä»»æ„ `allMenuKeys`
- âœ… **æ•°æ®åº“å±‚**ï¼š`admin_menu_permission` è¡¨ä¸é™åˆ¶ `menu_key` çš„å€¼ï¼Œå¯å­˜å‚¨ä»»æ„ key
- âš ï¸ **æ¥å£å±‚é™åˆ¶**ï¼šå½“å‰æ¥å£ä¸­ç¡¬ç¼–ç äº† `ALL_MENU_KEYS`ï¼Œéœ€è¦æ‰‹åŠ¨æ‰©å±•

**ç»“è®º**ï¼š
- åç«¯æ¶æ„**æ”¯æŒæ‰©å±•**ï¼Œä½†å½“å‰**åªè¦†ç›–"æ”¶ç›Šä¸ç¼–è¾‘ç®¡ç†"åˆ†ç»„**
- æ‰©å±•æ—¶éœ€è¦åŒæ—¶ä¿®æ”¹å‰ç«¯ `adminMenuConfig.ts` å’Œåç«¯ `admin.js` ä¸­çš„ `ALL_MENU_KEYS`

---

## 6. å°šæœªçº³å…¥æƒé™è®¾ç½®çš„åˆ†ç»„ä¸èœå•ï¼ˆéœ€è¦ä¸‹ä¸€æ­¥æ”¯æŒï¼‰

åŸºäºå‰é¢ 1~5 ç‚¹çš„åˆ†æï¼Œæ€»ç»“å¦‚ä¸‹ï¼š

### åˆ†ç»„å±‚é¢

#### âœ… å·²çº³å…¥æƒé™æ§åˆ¶çš„åˆ†ç»„

1. **æ”¶ç›Šä¸ç¼–è¾‘ç®¡ç†**
   - **groupKey**ï¼š`'group:income-editor'` âœ…
   - **æƒé™æ§åˆ¶çŠ¶æ€**ï¼šå·²çº³å…¥
   - **å¯è§æ€§åˆ¤æ–­**ï¼šé€šè¿‡ `hasMenuPermission('group:income-editor')` æ§åˆ¶
   - **å­èœå•æƒé™**ï¼š10 ä¸ªå­èœå•é¡¹å…¨éƒ¨æœ‰ menuKeyï¼Œå·²çº³å…¥æƒé™æ§åˆ¶

#### âŒ å°šæœªçº³å…¥æƒé™æ§åˆ¶çš„åˆ†ç»„/èœå•é¡¹

1. **é»˜è®¤ç»„ï¼ˆé¡¶éƒ¨ç‹¬ç«‹èœå•é¡¹ï¼‰**
   - **groupKey**ï¼š**æ— ** âŒ
   - **æƒé™æ§åˆ¶çŠ¶æ€**ï¼šæœªçº³å…¥
   - **åŒ…å«èœå•é¡¹**ï¼š
     - å°è¯´å®¡æ‰¹ï¼ˆactiveTab: `'novel-review'`ï¼‰
       - menuKeyï¼š**æ— ** âŒ
       - å½“å‰çŠ¶æ€ï¼šç¡¬ç¼–ç æ¸²æŸ“ï¼Œæ‰€æœ‰è§’è‰²å¯è§
     - æ–°å°è¯´æ± ï¼ˆactiveTab: `'new-novel-pool'`ï¼‰
       - menuKeyï¼š**æ— ** âŒ
       - å½“å‰çŠ¶æ€ï¼šç¡¬ç¼–ç æ¸²æŸ“ï¼Œæ‰€æœ‰è§’è‰²å¯è§
     - ç« èŠ‚å®¡æ‰¹ï¼ˆactiveTab: `'chapter-approval'`ï¼‰
       - menuKeyï¼š**æ— ** âŒ
       - å½“å‰çŠ¶æ€ï¼šç¡¬ç¼–ç æ¸²æŸ“ï¼Œæ‰€æœ‰è§’è‰²å¯è§

2. **é»˜è®¤ç»„ï¼ˆåº•éƒ¨ç‹¬ç«‹èœå•é¡¹ï¼‰**
   - **groupKey**ï¼š**æ— ** âŒ
   - **æƒé™æ§åˆ¶çŠ¶æ€**ï¼šæœªçº³å…¥
   - **åŒ…å«èœå•é¡¹**ï¼š
     - æˆ‘çš„æ”¶æ¬¾è´¦æˆ·ï¼ˆactiveTab: `'admin-payout-account'`ï¼‰
       - menuKeyï¼š**æ— ** âŒ
       - å½“å‰çŠ¶æ€ï¼šç¡¬ç¼–ç æ¸²æŸ“ï¼Œæ‰€æœ‰è§’è‰²å¯è§

### èœå•é¡¹å±‚é¢è¯¦ç»†æ¸…å•

#### âœ… å·²æœ‰ menuKey å¹¶åœ¨æƒé™é¡µé¢å¯é…ç½®çš„èœå•é¡¹ï¼ˆ10 é¡¹ï¼‰

å…¨éƒ¨å±äº"æ”¶ç›Šä¸ç¼–è¾‘ç®¡ç†"åˆ†ç»„ï¼š

1. `'payment-stats'` - è´¹ç”¨ç»Ÿè®¡
2. `'author-income'` - ä½œè€…æ”¶å…¥ç»Ÿè®¡
3. `'reader-income'` - è¯»è€…æ”¶å…¥ç»Ÿè®¡
4. `'settlement-overview'` - ç»“ç®—æ€»è§ˆ
5. `'base-income'` - åŸºç¡€æ”¶å…¥ç»Ÿè®¡-1
6. `'author-royalty'` - ä½œè€…åŸºç¡€æ”¶å…¥è¡¨-2
7. `'commission-transaction'` - æ¨å¹¿ä½£é‡‘æ˜ç»†-3
8. `'editor-base-income'` - ç¼–è¾‘åŸºç¡€æ”¶å…¥-4
9. `'commission-settings'` - ææˆè®¾ç½®
10. `'editor-management'` - ç¼–è¾‘ç®¡ç†

#### âŒ å°šæœªæœ‰ menuKeyã€ä¹Ÿæœªå‡ºç°åœ¨æƒé™é…ç½® UI ä¸­çš„èœå•é¡¹ï¼ˆ4 é¡¹ï¼‰

1. **å°è¯´å®¡æ‰¹**
   - activeTabï¼š`'novel-review'`
   - menuKeyï¼š**æ— **
   - æƒé™é…ç½® UIï¼š**æœªå‡ºç°**
   - å½“å‰å¯è§æ€§ï¼šæ‰€æœ‰è§’è‰²å¯è§

2. **æ–°å°è¯´æ± **
   - activeTabï¼š`'new-novel-pool'`
   - menuKeyï¼š**æ— **
   - æƒé™é…ç½® UIï¼š**æœªå‡ºç°**
   - å½“å‰å¯è§æ€§ï¼šæ‰€æœ‰è§’è‰²å¯è§

3. **ç« èŠ‚å®¡æ‰¹**
   - activeTabï¼š`'chapter-approval'`
   - menuKeyï¼š**æ— **
   - æƒé™é…ç½® UIï¼š**æœªå‡ºç°**
   - å½“å‰å¯è§æ€§ï¼šæ‰€æœ‰è§’è‰²å¯è§

4. **æˆ‘çš„æ”¶æ¬¾è´¦æˆ·**
   - activeTabï¼š`'admin-payout-account'`
   - menuKeyï¼š**æ— **
   - æƒé™é…ç½® UIï¼š**æœªå‡ºç°**
   - å½“å‰å¯è§æ€§ï¼šæ‰€æœ‰è§’è‰²å¯è§

### éœ€è¦æ‰©å±•çš„å†…å®¹æ¸…å•

#### å‰ç«¯éœ€è¦æ‰©å±•

1. **`adminMenuConfig.ts`**ï¼š
   - éœ€è¦ä¸º 4 ä¸ªç‹¬ç«‹èœå•é¡¹å®šä¹‰ menuKey
   - å¯é€‰ï¼šä¸º"é¡¶éƒ¨é»˜è®¤ç»„"å’Œ"åº•éƒ¨é»˜è®¤ç»„"å®šä¹‰ groupKeyï¼ˆå¦‚æœéœ€è¦å¯¹æ•´ç»„æ§åˆ¶ï¼‰
   - æ‰©å±• `AdminMenuItemKey` ç±»å‹
   - æ‰©å±• `ALL_MENU_KEYS` æ•°ç»„

2. **`AdminPanel.tsx`**ï¼š
   - ä¸º 4 ä¸ªç‹¬ç«‹èœå•é¡¹æ·»åŠ  `hasMenuPermission` åˆ¤æ–­
   - å¦‚æœå®šä¹‰äº† groupKeyï¼Œä¹Ÿéœ€è¦åˆ¤æ–­åˆ†ç»„å¯è§æ€§

3. **`PermissionManagementTab.tsx`**ï¼š
   - æ·»åŠ å…¶ä»–åˆ†ç»„çš„æƒé™é…ç½®å¡ç‰‡
   - æˆ–ä¸ºç‹¬ç«‹èœå•é¡¹æ·»åŠ å•ç‹¬çš„é…ç½®åŒºåŸŸ

#### åç«¯éœ€è¦æ‰©å±•

1. **`backend/routes/admin.js`**ï¼š
   - æ‰©å±• `ALL_MENU_KEYS` æ•°ç»„ï¼Œæ·»åŠ æ–°çš„ menuKey å’Œ groupKey
   - ç¡®ä¿ä¸å‰ç«¯ `ALL_MENU_KEYS` ä¿æŒä¸€è‡´

2. **æ•°æ®åº“**ï¼š
   - æ— éœ€ä¿®æ”¹ï¼ˆ`admin_menu_permission` è¡¨å·²æ”¯æŒä»»æ„ keyï¼‰

### æ‰©å±•å»ºè®®

**æ–¹æ¡ˆä¸€ï¼šç‹¬ç«‹èœå•é¡¹ä¸åˆ†ç»„**
- ä¸ºæ¯ä¸ªç‹¬ç«‹èœå•é¡¹å®šä¹‰ menuKeyï¼ˆå¦‚ `'novel-review'`, `'new-novel-pool'`, `'chapter-approval'`, `'admin-payout-account'`ï¼‰
- åœ¨æƒé™é…ç½®é¡µé¢ä¸­ï¼Œå¯ä»¥å•ç‹¬æ˜¾ç¤ºè¿™äº›èœå•é¡¹ï¼ˆä¸æ”¾åœ¨åˆ†ç»„ä¸‹ï¼‰

**æ–¹æ¡ˆäºŒï¼šå°†ç‹¬ç«‹èœå•é¡¹å½’å…¥è™šæ‹Ÿåˆ†ç»„**
- å®šä¹‰ groupKeyï¼ˆå¦‚ `'group:content-management'` åŒ…å«å°è¯´å®¡æ‰¹ã€æ–°å°è¯´æ± ã€ç« èŠ‚å®¡æ‰¹ï¼‰
- å®šä¹‰ groupKeyï¼ˆå¦‚ `'group:account-management'` åŒ…å«æˆ‘çš„æ”¶æ¬¾è´¦æˆ·ï¼‰
- åœ¨æƒé™é…ç½®é¡µé¢ä¸­ï¼ŒæŒ‰åˆ†ç»„å±•ç¤º

**æ¨èæ–¹æ¡ˆ**ï¼š**æ–¹æ¡ˆä¸€**ï¼ˆç‹¬ç«‹èœå•é¡¹ä¸åˆ†ç»„ï¼‰
- æ›´çµæ´»ï¼Œæ¯ä¸ªèœå•é¡¹å¯ç‹¬ç«‹æ§åˆ¶
- å®ç°ç®€å•ï¼Œä¸éœ€è¦å®šä¹‰é¢å¤–çš„åˆ†ç»„ç»“æ„
- ç¬¦åˆå½“å‰"æ”¶ç›Šä¸ç¼–è¾‘ç®¡ç†"æ˜¯å”¯ä¸€çœŸå®åˆ†ç»„çš„ç°çŠ¶

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**ï¼š2025-12-01  
**åˆ†æèŒƒå›´**ï¼šåå°å·¦ä¾§å¯¼èˆªèœå•æƒé™è¦†ç›–èŒƒå›´  
**åˆ†æç›®çš„**ï¼šä¸ºå°†æ‰€æœ‰èœå•çº³å…¥æƒé™ä½“ç³»åšå‡†å¤‡

