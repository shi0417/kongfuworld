<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bookmarksé¡µé¢æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-section h3 {
            color: #333;
            margin-top: 0;
        }
        .api-test {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        .api-test button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        .api-test button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #e9ecef;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“š Bookmarksé¡µé¢åŠŸèƒ½æµ‹è¯•</h1>
        <p>æµ‹è¯•Bookmarksé¡µé¢çš„APIæ¥å£å’ŒåŠŸèƒ½</p>

        <!-- ç”¨æˆ·ä¿¡æ¯ -->
        <div class="test-section">
            <h3>ğŸ‘¤ ç”¨æˆ·ä¿¡æ¯</h3>
            <div class="api-test">
                <button onclick="getUserInfo()">è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯</button>
                <div id="userInfo" class="result info"></div>
            </div>
        </div>

        <!-- å½“å‰é˜…è¯»åˆ—è¡¨æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ“– å½“å‰é˜…è¯»åˆ—è¡¨æµ‹è¯•</h3>
            <div class="api-test">
                <button onclick="testCurrentReads()">è·å–å½“å‰é˜…è¯»åˆ—è¡¨</button>
                <div id="currentReadsResult" class="result"></div>
            </div>
        </div>

        <!-- æ”¶è—ç« èŠ‚åˆ—è¡¨æµ‹è¯• -->
        <div class="test-section">
            <h3>â­ æ”¶è—ç« èŠ‚åˆ—è¡¨æµ‹è¯•</h3>
            <div class="api-test">
                <button onclick="testFavoriteChapters()">è·å–æ”¶è—ç« èŠ‚åˆ—è¡¨</button>
                <div id="favoriteChaptersResult" class="result"></div>
            </div>
        </div>

        <!-- ä¹¦ç­¾é”å®šæµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ”’ ä¹¦ç­¾é”å®šåŠŸèƒ½æµ‹è¯•</h3>
            <div class="api-test">
                <label>å°è¯´ID: <input type="number" id="lockNovelId" value="10" style="width: 60px;"></label>
                <button onclick="testToggleBookmarkLock()">åˆ‡æ¢ä¹¦ç­¾é”å®šçŠ¶æ€</button>
                <div id="bookmarkLockResult" class="result"></div>
            </div>
        </div>

        <!-- é€šçŸ¥å¼€å…³æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ”” é€šçŸ¥å¼€å…³åŠŸèƒ½æµ‹è¯•</h3>
            <div class="api-test">
                <label>å°è¯´ID: <input type="number" id="notificationNovelId" value="10" style="width: 60px;"></label>
                <button onclick="testToggleNotification()">åˆ‡æ¢é€šçŸ¥çŠ¶æ€</button>
                <div id="notificationResult" class="result"></div>
            </div>
        </div>

        <!-- ç§»é™¤å°è¯´æµ‹è¯• -->
        <div class="test-section">
            <h3>âŒ ç§»é™¤å°è¯´æµ‹è¯•</h3>
            <div class="api-test">
                <label>å°è¯´ID: <input type="number" id="removeNovelId" value="10" style="width: 60px;"></label>
                <button onclick="testRemoveNovel()">ç§»é™¤å°è¯´ä¹¦ç­¾</button>
                <div id="removeNovelResult" class="result"></div>
            </div>
        </div>

        <!-- ç§»é™¤æ”¶è—ç« èŠ‚æµ‹è¯• -->
        <div class="test-section">
            <h3>âŒ ç§»é™¤æ”¶è—ç« èŠ‚æµ‹è¯•</h3>
            <div class="api-test">
                <label>å°è¯´ID: <input type="number" id="removeChapterNovelId" value="10" style="width: 60px;"></label>
                <label>ç« èŠ‚ID: <input type="number" id="removeChapterId" value="1" style="width: 60px;"></label>
                <button onclick="testRemoveFavoriteChapter()">ç§»é™¤æ”¶è—ç« èŠ‚</button>
                <div id="removeChapterResult" class="result"></div>
            </div>
        </div>

        <!-- é¡µé¢è®¿é—®æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸŒ é¡µé¢è®¿é—®æµ‹è¯•</h3>
            <div class="api-test">
                <button onclick="openBookmarksPage()">æ‰“å¼€Bookmarksé¡µé¢</button>
                <p>ç‚¹å‡»æŒ‰é’®å°†åœ¨æ–°çª—å£ä¸­æ‰“å¼€ http://localhost:3000/bookmarks</p>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';
        let currentUserId = null;

        // è·å–ç”¨æˆ·ä¿¡æ¯
        async function getUserInfo() {
            try {
                const response = await fetch(`${API_BASE}/auth/me`, {
                    method: 'GET',
                    credentials: 'include'
                });
                const data = await response.json();
                
                const resultDiv = document.getElementById('userInfo');
                if (data.success && data.user) {
                    currentUserId = data.user.id;
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `ç”¨æˆ·ID: ${data.user.id}\nç”¨æˆ·å: ${data.user.username}\né‚®ç®±: ${data.user.email}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = 'æœªç™»å½•æˆ–è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥\nè¯·å…ˆç™»å½•ç³»ç»Ÿ';
                }
            } catch (error) {
                document.getElementById('userInfo').className = 'result error';
                document.getElementById('userInfo').textContent = 'è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥: ' + error.message;
            }
        }

        // æµ‹è¯•å½“å‰é˜…è¯»åˆ—è¡¨
        async function testCurrentReads() {
            if (!currentUserId) {
                document.getElementById('currentReadsResult').className = 'result error';
                document.getElementById('currentReadsResult').textContent = 'è¯·å…ˆè·å–ç”¨æˆ·ä¿¡æ¯';
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/bookmarks/current-reads/${currentUserId}`, {
                    method: 'GET',
                    credentials: 'include'
                });
                const data = await response.json();
                
                const resultDiv = document.getElementById('currentReadsResult');
                if (data.success) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `è·å–æˆåŠŸï¼\næ‰¾åˆ° ${data.data.length} æœ¬å°è¯´\n\n` + 
                        JSON.stringify(data.data, null, 2);
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = 'è·å–å¤±è´¥: ' + data.message;
                }
            } catch (error) {
                document.getElementById('currentReadsResult').className = 'result error';
                document.getElementById('currentReadsResult').textContent = 'è¯·æ±‚å¤±è´¥: ' + error.message;
            }
        }

        // æµ‹è¯•æ”¶è—ç« èŠ‚åˆ—è¡¨
        async function testFavoriteChapters() {
            if (!currentUserId) {
                document.getElementById('favoriteChaptersResult').className = 'result error';
                document.getElementById('favoriteChaptersResult').textContent = 'è¯·å…ˆè·å–ç”¨æˆ·ä¿¡æ¯';
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/bookmarks/favorite-chapters/${currentUserId}`, {
                    method: 'GET',
                    credentials: 'include'
                });
                const data = await response.json();
                
                const resultDiv = document.getElementById('favoriteChaptersResult');
                if (data.success) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `è·å–æˆåŠŸï¼\næ‰¾åˆ° ${data.data.length} æœ¬æ”¶è—å°è¯´\n\n` + 
                        JSON.stringify(data.data, null, 2);
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = 'è·å–å¤±è´¥: ' + data.message;
                }
            } catch (error) {
                document.getElementById('favoriteChaptersResult').className = 'result error';
                document.getElementById('favoriteChaptersResult').textContent = 'è¯·æ±‚å¤±è´¥: ' + error.message;
            }
        }

        // æµ‹è¯•åˆ‡æ¢ä¹¦ç­¾é”å®šçŠ¶æ€
        async function testToggleBookmarkLock() {
            if (!currentUserId) {
                document.getElementById('bookmarkLockResult').className = 'result error';
                document.getElementById('bookmarkLockResult').textContent = 'è¯·å…ˆè·å–ç”¨æˆ·ä¿¡æ¯';
                return;
            }

            const novelId = document.getElementById('lockNovelId').value;
            const currentStatus = Math.random() > 0.5 ? 1 : 0; // éšæœºçŠ¶æ€

            try {
                const response = await fetch(`${API_BASE}/bookmarks/toggle-bookmark-lock`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        user_id: currentUserId,
                        novel_id: parseInt(novelId),
                        status: currentStatus
                    })
                });
                const data = await response.json();
                
                const resultDiv = document.getElementById('bookmarkLockResult');
                if (data.success) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `æ“ä½œæˆåŠŸï¼\nå°è¯´ID: ${novelId}\næ–°çŠ¶æ€: ${data.bookmark_closed}\næ¶ˆæ¯: ${data.message}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = 'æ“ä½œå¤±è´¥: ' + data.message;
                }
            } catch (error) {
                document.getElementById('bookmarkLockResult').className = 'result error';
                document.getElementById('bookmarkLockResult').textContent = 'è¯·æ±‚å¤±è´¥: ' + error.message;
            }
        }

        // æµ‹è¯•åˆ‡æ¢é€šçŸ¥çŠ¶æ€
        async function testToggleNotification() {
            if (!currentUserId) {
                document.getElementById('notificationResult').className = 'result error';
                document.getElementById('notificationResult').textContent = 'è¯·å…ˆè·å–ç”¨æˆ·ä¿¡æ¯';
                return;
            }

            const novelId = document.getElementById('notificationNovelId').value;
            const currentStatus = Math.random() > 0.5 ? 1 : 0; // éšæœºçŠ¶æ€

            try {
                const response = await fetch(`${API_BASE}/bookmarks/toggle-notification`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        user_id: currentUserId,
                        novel_id: parseInt(novelId),
                        status: currentStatus
                    })
                });
                const data = await response.json();
                
                const resultDiv = document.getElementById('notificationResult');
                if (data.success) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `æ“ä½œæˆåŠŸï¼\nå°è¯´ID: ${novelId}\næ–°çŠ¶æ€: ${data.notification_off}\næ¶ˆæ¯: ${data.message}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = 'æ“ä½œå¤±è´¥: ' + data.message;
                }
            } catch (error) {
                document.getElementById('notificationResult').className = 'result error';
                document.getElementById('notificationResult').textContent = 'è¯·æ±‚å¤±è´¥: ' + error.message;
            }
        }

        // æµ‹è¯•ç§»é™¤å°è¯´
        async function testRemoveNovel() {
            if (!currentUserId) {
                document.getElementById('removeNovelResult').className = 'result error';
                document.getElementById('removeNovelResult').textContent = 'è¯·å…ˆè·å–ç”¨æˆ·ä¿¡æ¯';
                return;
            }

            const novelId = document.getElementById('removeNovelId').value;

            try {
                const response = await fetch(`${API_BASE}/bookmarks/remove-novel/${currentUserId}/${novelId}`, {
                    method: 'DELETE',
                    credentials: 'include'
                });
                const data = await response.json();
                
                const resultDiv = document.getElementById('removeNovelResult');
                if (data.success) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `ç§»é™¤æˆåŠŸï¼\nå°è¯´ID: ${novelId}\næ¶ˆæ¯: ${data.message}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = 'ç§»é™¤å¤±è´¥: ' + data.message;
                }
            } catch (error) {
                document.getElementById('removeNovelResult').className = 'result error';
                document.getElementById('removeNovelResult').textContent = 'è¯·æ±‚å¤±è´¥: ' + error.message;
            }
        }

        // æµ‹è¯•ç§»é™¤æ”¶è—ç« èŠ‚
        async function testRemoveFavoriteChapter() {
            if (!currentUserId) {
                document.getElementById('removeChapterResult').className = 'result error';
                document.getElementById('removeChapterResult').textContent = 'è¯·å…ˆè·å–ç”¨æˆ·ä¿¡æ¯';
                return;
            }

            const novelId = document.getElementById('removeChapterNovelId').value;
            const chapterId = document.getElementById('removeChapterId').value;

            try {
                const response = await fetch(`${API_BASE}/bookmarks/remove-favorite-chapter`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        user_id: currentUserId,
                        novel_id: parseInt(novelId),
                        chapter_id: parseInt(chapterId)
                    })
                });
                const data = await response.json();
                
                const resultDiv = document.getElementById('removeChapterResult');
                if (data.success) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `ç§»é™¤æˆåŠŸï¼\nå°è¯´ID: ${novelId}\nç« èŠ‚ID: ${chapterId}\næ¶ˆæ¯: ${data.message}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = 'ç§»é™¤å¤±è´¥: ' + data.message;
                }
            } catch (error) {
                document.getElementById('removeChapterResult').className = 'result error';
                document.getElementById('removeChapterResult').textContent = 'è¯·æ±‚å¤±è´¥: ' + error.message;
            }
        }

        // æ‰“å¼€Bookmarksé¡µé¢
        function openBookmarksPage() {
            window.open('http://localhost:3000/bookmarks', '_blank');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è·å–ç”¨æˆ·ä¿¡æ¯
        window.onload = function() {
            getUserInfo();
        };
    </script>
</body>
</html>
